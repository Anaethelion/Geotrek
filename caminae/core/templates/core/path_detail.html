{% extends "mapentity/entity_detail.html" %}
{% load i18n static field_verbose_name %}

{% block extrahead %}
    {{ block.super }}
    <script type="text/javascript" src="{% static "mapentity/jquery.sparkline.js" %}"></script>
{% endblock extrahead %}

{% block extratitle %}{% endblock extratitle %}

{% block detailspanel %}
    {{ block.super }}

    {% if not path.valid %}
        <div class="alert alert-error"><strong>{% trans "Invalid" %}</strong></div>
    {% endif %}
    
    <div class="groupfields">
        <h4>{{ path|verbose:"comments" }}</h4>
        {{ path.comments|default:_("None")|safe }}
    </div>

    <table class="table-striped table-bordered table">
        <tr>
            <th>{{ path|verbose:"departure" }}</th>
            <td>{{ path.departure }}</td>
        </tr>
        <tr>
            <th>{{ path|verbose:"arrival" }}</th>
            <td>{{ path.arrival }}</td>
        </tr>
        <tr>
            <th>{{ path|verbose:"comfort" }}</th>
            <td>{% if path.comfort %}{{ path.confort }}
                {% else %}<span class="none">{% trans "None" %}</span>{% endif %}
            </td>
        </tr>
        {% include "core/elevationinfo_fragment.html" %}
        <tr>
            <th>{{ path|verbose:"trail" }}</th>
            <td>{{ path.trail_display|safe }}</td>
        </tr><tr>
            <th>{{ path|verbose:"datasource" }}</th>
            <td>{% if path.datasource %}{{ path.datasource }}
                {% else %}<span class="none">{% trans "None" %}</span>{% endif %}
            </td>
        </tr><tr>
            <th>{{ path|verbose:"stake" }}</th>
            <td>{% if path.stake %}{{ path.stake }}
                {% else %}<span class="none">{% trans "None" %}</span>{% endif %}
            </td>
        </tr>
        <tr>
            <th>{{ path|verbose:"usages" }}</th>
            <td>
                {% for usage in  path.usages.all %}
                    {% if forloop.first %}<ul>{% endif %}
                    <li> {{ usage }} </li>
                    {% if forloop.last %}</ul>{% endif %}
                {% empty %}
                    <span class="none">{% trans "None" %}</span>
                {% endfor %}
            </td>
        </tr><tr>
            <th>{{ path|verbose:"networks" }}</th>
            <td>
                {% for network in  path.networks.all %}
                    {% if forloop.first %}<ul>{% endif %}
                    <li> {{ network }} </li>
                    {% if forloop.last %}</ul>{% endif %}
                {% empty %}
                    <span class="none">{% trans "None" %}</span>
                {% endfor %}
            </td>
        </tr>
        {% include "mapentity/trackinfo_fragment.html" %}
    </table>
{% endblock detailspanel %}


{% block mappanel %}
    {{ block.super }}
    <div id="altitudegraph">
        <h4>{% trans "Altitude profile" %}</h4>
        <p class="axislabel">{% trans "Altitude (m)" %}</p>
        <span id="profilealtitude"></span> <span class="axislabel" style="position:relative; top:85px">{% trans "Distance (m)" %}</span>
        <p id="mouseoverprofil" class="axislabel" >&nbsp;</p>
    </div>

    <div class="span11"></div><!-- clear -->
{% endblock mappanel %}

{% block extrabody %}
    {{ block.super }}
    <script type="text/javascript">
        $(function() {
            /* 
             * Load altimetric profile from JSON
             */
            $.getJSON("{% url core:path_profile path.pk %}", function(data) {
                $('#profilealtitude').sparkline(data.profile, {tooltipSuffix: ' m', width: 300, height: 100});
                $('#profilealtitude').bind('sparklineRegionChange', function(ev) {
                    var sparkline = ev.sparklines[0],
                        region = sparkline.getCurrentRegionFields();
                        value = region.y;
                    $('#mouseoverprofil').text(Math.round(region.x) +" m");
                }).bind('mouseleave', function() {
                    $('#mouseoverprofil').text('');
                });
            });
        });
    </script>
{% endblock extrabody %}
